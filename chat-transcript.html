<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Travelio Project Chat Transcript</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        color-scheme: light dark;
        --bg: #f8fafc;
        --card: #ffffff;
        --text: #0f172a;
        --subtle: #475569;
        --border: #e2e8f0;
        --accent: #2563eb;
        --user: #1d4ed8;
        --assistant: #0ea5e9;
      }
      @media (prefers-color-scheme: dark) {
        :root {
          --bg: #0f172a;
          --card: #16213a;
          --text: #e2e8f0;
          --subtle: #94a3b8;
          --border: #1e293b;
          --user: #2563eb;
          --assistant: #22d3ee;
        }
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        background: var(--bg);
        color: var(--text);
      }
      header {
        padding: 2.5rem 1.5rem 1.5rem;
        max-width: 960px;
        margin: 0 auto;
      }
      h1 {
        margin: 0 0 0.5rem;
        font-size: clamp(2rem, 5vw, 2.75rem);
      }
      p.lead {
        margin: 0;
        font-size: 1.05rem;
        color: var(--subtle);
      }
      main {
        max-width: 960px;
        margin: 0 auto 4rem;
        padding: 0 1.5rem 4rem;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }
      section.entry {
        background: var(--card);
        border-radius: 18px;
        border: 1px solid var(--border);
        padding: 1.5rem;
        box-shadow: 0 24px 48px -30px rgba(37, 56, 88, 0.22);
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      section.entry h2 {
        margin: 0;
        font-size: 1.1rem;
        color: var(--accent);
      }
      .conversation {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }
      .bubble {
        max-width: 680px;
        padding: 0.85rem 1rem;
        border-radius: 14px;
        background: rgba(148, 163, 184, 0.18);
        position: relative;
        line-height: 1.55;
      }
      .bubble.user {
        align-self: flex-start;
        background: rgba(29, 78, 216, 0.12);
        border-left: 3px solid var(--user);
      }
      .bubble.assistant {
        align-self: flex-end;
        background: rgba(14, 165, 233, 0.12);
        border-right: 3px solid var(--assistant);
      }
      .speaker {
        display: block;
        font-weight: 600;
        font-size: 0.85rem;
        color: var(--subtle);
        margin-bottom: 0.4rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }
      .message {
        white-space: pre-wrap;
      }
      footer {
        max-width: 960px;
        margin: 0 auto 3rem;
        padding: 0 1.5rem;
        color: var(--subtle);
        font-size: 0.85rem;
      }
      .error-banner {
        background: rgba(220, 38, 38, 0.15);
        color: #b91c1c;
        padding: 1rem;
        border-radius: 12px;
        border: 1px solid rgba(220, 38, 38, 0.3);
      }
      @media (max-width: 640px) {
        section.entry {
          padding: 1.25rem;
        }
        .bubble {
          max-width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Travelio Project • Chat Archive</h1>
      <p class="lead">
        This page renders the Markdown transcript stored under <code>/chat-archive/transcript.md</code>.
        Append future sessions to that file to keep the full context handy.
      </p>
    </header>
    <main id="entries">
      <div class="error-banner" id="loading">Loading transcript…</div>
    </main>
    <footer>
      <p>
        To log future discussions, copy the Markdown pattern (<code>## Session Title</code> + <code>- **Speaker:**</code>
        lines) inside <code>chat-archive/transcript.md</code>. This page will render them automatically.
      </p>
    </footer>
    <script>
      const mdPath = "chat-archive/transcript.md";
      const container = document.getElementById("entries");
      const loadingBanner = document.getElementById("loading");

      function parseTranscript(markdown) {
        const lines = markdown.split(/\r?\n/);
        const sections = [];
        let current = null;

        for (const line of lines) {
          if (!line.trim()) continue;
          if (line.startsWith("## ")) {
            if (current) sections.push(current);
            current = { title: line.replace(/^##\s*/, ""), messages: [] };
          } else if (line.startsWith("- **")) {
            if (!current) continue;
            const match = line.match(/^\- \*\*(.+?)\:\*\*\s*(.*)$/);
            if (match) {
              const [, speaker, text] = match;
              current.messages.push({ speaker, text });
            } else {
              current.messages.push({ speaker: "Note", text: line.replace(/^\-\s*/, "") });
            }
          }
        }
        if (current) sections.push(current);
        return sections;
      }

      function renderSections(sections) {
        container.innerHTML = "";
        if (!sections.length) {
          container.innerHTML = '<div class="error-banner">No transcript entries found.</div>';
          return;
        }

        sections.forEach((section, index) => {
          const sectionEl = document.createElement("section");
          sectionEl.className = "entry";
          sectionEl.id = `session-${index + 1}`;

          const titleEl = document.createElement("h2");
          titleEl.textContent = section.title;
          sectionEl.appendChild(titleEl);

          const convoEl = document.createElement("div");
          convoEl.className = "conversation";

          section.messages.forEach((message) => {
            const bubble = document.createElement("div");
            const normalizedSpeaker = message.speaker.toLowerCase();
            bubble.className = `bubble ${normalizedSpeaker.includes("user") ? "user" : "assistant"}`;

            const speakerLabel = document.createElement("span");
            speakerLabel.className = "speaker";
            speakerLabel.textContent = message.speaker;

            const body = document.createElement("div");
            body.className = "message";
            body.textContent = message.text;

            bubble.appendChild(speakerLabel);
            bubble.appendChild(body);
            convoEl.appendChild(bubble);
          });

          sectionEl.appendChild(convoEl);
          container.appendChild(sectionEl);
        });
      }

      async function loadTranscript() {
        try {
          const response = await fetch(mdPath);
          if (!response.ok) {
            throw new Error(`Failed to load transcript (${response.status})`);
          }
          const markdown = await response.text();
          const sections = parseTranscript(markdown);
          renderSections(sections);
        } catch (error) {
          container.innerHTML = `
            <div class="error-banner">
              Could not load transcript: ${error.message}
            </div>
          `;
        }
      }

      loadTranscript().finally(() => {
        if (loadingBanner) loadingBanner.remove();
      });
    </script>
  </body>
</html>
